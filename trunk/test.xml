<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Hello Wave">
    <Require feature="wave-preview" /> 
  </ModulePrefs>
  <Content type="html">
    <![CDATA[     
<div id="content_div" style="height: 50px;"></div>
    <script type="text/javascript">

    var div = document.getElementById('content_div');

    function logThis(obj) {
     /*if (window.console && console.log) {
       console.log(obj);
     } else { */
       msg.createDismissibleMessage(obj.toString());
     /* } */
    }

    function getGreetings() {
     var participants = wave.getParticipants();
     var name = null;
     if (participants) {
      for (var i = 0; i < participants.length; ++i) {
	if (participants[i] = wave.getViewer()) {
	  name = participants[i].getName();
	  if (!name) {
	   name = participants[i].getId();
	  }
	}
       }
/* } */
}
   var hello = "Hello";
   logThis("'hello' value is: " + hello);
   if (name) {
	hello = hello + ", " + name;
   }
   logThis("New 'hello' value is: " + hello);
   logThis(wave.getState());
   return hello;
}

    function buttonClicked() {
      var value = parseInt(wave.getState().get('count', '0'));
      wave.getState().submitDelta({'count': value + 1});
    }

    function stateUpdated() {
      var hello = getGreetings();
      if (!hello) {
	hello = "hola"
      }
      if(!wave.getState().get('count')) {
        div.innerHTML = hello + "The count is 0."
      }
      else {
        div.innerHTML = hello + "The count is " + wave.getState().get('count');
      } 
    }
 
    function init() {
      if (wave && wave.isInWaveContainer()) {
        wave.setStateCallback(stateUpdated);
      }
    }
    gadgets.util.registerOnLoadHandler(init);

    // Reset value of "count" to 0
    function resetCounter(){
      wave.getState().submitDelta({'count': '0'});
    }

    </script>
    <input type=button value="Click Me!" id="butCount" onClick="buttonClicked()">
    <input type=button value="Reset" id="butReset" onClick="resetCounter()">
    ]]>
  </Content>
</Module>
